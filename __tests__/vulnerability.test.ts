import {expect, test} from '@jest/globals'
import {findMentionedVulnerabilities, CveId, GhsaId} from '../src/vulnerability'

describe('findMentionedVulnerabilities', () => {
  test('searches array', async () => {
    const input = ['CVE-5555-1234', 'cvE-2022-2222']

    expect(findMentionedVulnerabilities(input)).toEqual([
      new CveId('CVE-5555-1234'),
      new CveId('CVE-2022-2222')
    ])
  })

  test('results are unique', async () => {
    const input = ['cvE-2022-2222  cvE-2022-2222  cvE-2022-2222 lorem']

    expect(findMentionedVulnerabilities(input).length).toBe(1)
  })

  test('searches finds CVE', async () => {
    const input = ['cvE-2022-2222']
    expect(findMentionedVulnerabilities(input)).toEqual([
      new CveId('cvE-2022-2222')
    ])
  })

  test('searches finds github advisory id from url', async () => {
    const input = [
      'oooo https://github.com/advisories/GHSA-vv3r-fxqp-vr3f aaaa'
    ]
    expect(findMentionedVulnerabilities(input)).toEqual([
      new GhsaId('GHSA-vv3r-fxqp-vr3f')
    ])
  })

  test('searches finds github advisory id standalone', async () => {
    const input = ['GHSA-vv3r-fxqp-vr3f']
    expect(findMentionedVulnerabilities(input)).toEqual([
      new GhsaId('GHSA-vv3r-fxqp-vr3f')
    ])
  })
})
